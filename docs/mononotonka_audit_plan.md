# Mononotonka ラッパーライブラリ調査計画

## 1. 目的
- `mononotonka` フォルダ配下の実装に、設計不整合・不具合リスク・保守性低下要因がないかを体系的に確認する。
- `manual` 配下ドキュメントと実装のズレ（API名、引数、挙動説明、利用手順）を検出し、修正方針を明確化する。

## 2. 調査対象
- 実装対象: `mononotonka/*.cs`
- ドキュメント対象: `manual/*.html`, `manual/style.css`（必要時）
- 参照対象: `GameMain.cs`, `SampleScene*.cs`, `README.md`（実利用例との整合確認のみ）

## 3. 調査対象外
- 新機能追加、設計刷新、大規模リファクタリング
- 互換性維持を前提にした過度な最適化
- サンプルゲームのゲームデザイン品質評価

## 4. 成果物
- 調査報告書: `docs/mononotonka_audit_report.md`
- API差分表: `docs/mononotonka_manual_gap_matrix.md`
- 修正提案一覧（必要時）: `docs/mononotonka_fix_proposals.md`

## 5. 進め方（フェーズ）

### Phase 0: キックオフと基準固定
- ライブラリの利用前提（`Ton.Instance.Initialize/Update/Draw` のライフサイクル）を基準として明文化。
- 重大度定義を確定。
  - Critical: クラッシュ、データ破損、明確なコンパイル不可
  - High: 主要機能の誤動作、誤用を誘発するAPI/文書不一致
  - Medium: 制約未記載、挙動のあいまいさ、性能劣化リスク
  - Low: 表記揺れ、軽微な説明不足

### Phase 1: 実装インベントリ作成
- `mononotonka/*.cs` から公開APIを抽出し、クラス単位で一覧化。
  - 対象例: `Ton`, `TonGraphics`, `TonInput`, `TonSound`, `TonScene`, `TonMessage` など
- 各APIの以下を整理。
  - シグネチャ（メソッド名、引数、戻り値）
  - 前提条件（初期化順、呼び出しタイミング）
  - 副作用（状態変更、キャッシュ、I/O、ログ）

### Phase 2: 実装健全性レビュー
- 観点別に静的レビューを実施。
  - 初期化/終了: Initialize/Terminateの順序、未初期化アクセスリスク
  - 描画: Begin/Endの整合、描画状態の復元、RenderTarget管理
  - 入力: フレーム境界での状態遷移、`ConsumeInput` の影響範囲
  - サウンド: キャッシュ解放、フェード処理、リソース解放漏れ
  - シーン: 遷移中の更新順、Terminate漏れ、二重遷移防止
  - 保存系: 例外処理、ファイルI/O失敗時のリカバリ
  - ログ/エラー: 例外握りつぶしの有無、診断可能性
- 「実害のある問題」と「改善提案」を分離して記録。

### Phase 3: マニュアル整合性検証
- `manual` から API説明を抽出し、Phase 1の実API一覧と突合。
- 以下の差分を分類。
  - API存在差分: manualにあるが実装にない / 実装にあるがmanualにない
  - シグネチャ差分: 引数順、型、既定値、戻り値
  - 挙動差分: manual説明と実挙動（例: 自動呼び出し、キャッシュ仕様）
  - 用語差分: インターフェース名、ショートカット名、クラス名表記
- 差分ごとに「修正先（実装 or manual）」を提案。

### Phase 4: 利用例との整合確認
- `GameMain.cs` と `SampleScene*.cs` を用いて、実運用上の呼び出しパターンを確認。
- manual推奨手順とサンプル実装が矛盾していないかを確認。

### Phase 5: 動作確認（品質ゲート）
- 軽微な設定変更/資料変更以外の修正が発生する場合に限り、ビルド/テストを実施。
- 実施内容（成功/失敗、失敗時の原因）を報告書に明記。

## 6. レポート記載フォーマット
- 問題ID
- 重大度
- 対象ファイル（実装/manual）
- 根拠（該当API、該当箇所）
- 影響範囲
- 推奨対応
- 対応方針（実装修正 / 文書修正 / 両方）

## 7. 受け入れ基準
- 公開APIの実装・manual差分が網羅的に一覧化されていること。
- Critical/Highの問題について、修正先と対応案が明確であること。
- 調査結果に再現可能な根拠（ファイル・箇所）が付与されていること。

## 8. 想定リスクと対策
- manual側の表現揺れで誤検出が起きるリスク
  - 対策: 「表記揺れ」と「実害差分」を分離して管理
- サンプル実装が古く、現在仕様と完全一致しないリスク
  - 対策: `Ton` を起点とした実装を正として判断し、サンプル差分は注記扱い
- 仕様が暗黙で決まっているリスク
  - 対策: 根拠不十分項目は「要確認事項」として明示

## 9. 実行順序（今回）
1. Phase 1（APIインベントリ作成）
2. Phase 2（実装健全性レビュー）
3. Phase 3（manual整合性検証）
4. Phase 4（利用例整合確認）
5. Phase 5（必要時のみビルド/テスト）
6. 成果物3点を `docs` に出力

## 10. 実施予定メモ
- 本調査は明日（2026-02-24）に実施開始する。
